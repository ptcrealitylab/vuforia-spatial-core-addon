<!DOCTYPE html>
<html lang="en">
  <head>
      <script src="objectDefaultFiles/object.js"></script>
      <script src="objectDefaultFiles/pep.min.js"></script>
      <script src="objectDefaultFiles/envelopeContents.js"></script>
      <meta charset="UTF-8">
      <title>square-wave</title>
      <style>
      </style>
  </head>
  <body style="width: 284px; height: 284px">
    <svg width="284px" height="284px" viewBox="0 0 284 284" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="icon-copy-4">
                <g id="Group">
                    <rect id="Rectangle" stroke="rgb(45,255,255)" stroke-width="11" fill="rgba(0,0,0,0.5)" x="5.5" y="5.5" width="273" height="273" rx="70"></rect>
                    <polyline id="Path" stroke="#00FF02" stroke-width="5" points="11 138.5 41 138.5 41 254 105 254 102 23 182 23 184 254 244 254 244 138.5 273 138.5"></polyline>
                </g>
            </g>
        </g>
    </svg>
    <script>
        var path = document.querySelector('#Path');
        var powered = false;
        
        path.setAttribute('stroke', '#999999');

        try {
            var realityInterface = new RealityInterface();
            realityInterface.initNode('speed', 'node', -25, 10);
            realityInterface.initNode('power', 'node', -25, -10);
            realityInterface.initNode('output', 'signal', 25, 0);
            realityInterface.writePublicData('output', 'wave', 'square');

            var _envelopeContents = new EnvelopeContents(realityInterface, document.body);
        } catch (e) {
            console.warn('Reality Interface is not accessible');
        }
        
        try {
            realityInterface.addReadListener('power', function (e) { // This ensures the wave continues smooth movement when changing speeds
                powered = e.value >= 0.001;
                if (powered) {
                    path.setAttribute('stroke', '#00FF02');
                } else {
                    path.setAttribute('stroke', '#999999');
                }
                realityInterface.write('output', e.value);
            });
            realityInterface.addReadListener('speed', function (e) {
                realityInterface.writePublicData('output', 'speed', e.value);
            });
        } catch (e) {
            console.warn('Reality Interface is not accessible');
        }
    </script>
  </body>
</html>
